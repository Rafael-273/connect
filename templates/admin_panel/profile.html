{% extends 'admin_base.html' %}
{% load static %}

{% block title %}Meu Perfil - Painel Administrativo{% endblock %}

{% block content %}
<div class="flex min-h-screen bg-gray-50">
    {% include 'parciais/admin_sidebar.html' %}
    <div class="flex-1 ml-64">
        <div class="p-6 mt-24">
            <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-2xl p-8">
                {% if messages %}
                    <div class="mb-4">
                        {% for message in messages %}
                            <div class="p-3 rounded text-center text-white font-semibold {% if message.tags == 'success' %}bg-green-500{% else %}bg-red-500{% endif %}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
                <form method="post" enctype="multipart/form-data" class="space-y-6" id="profile-form">
                    {% csrf_token %}
                    <div class="flex flex-col items-center mb-6 relative group">
                        <div class="relative group/avatar">
                            <img id="avatar-preview" src="{% if user.avatar %}{{ user.avatar.url }}{% endif %}" alt="Avatar" class="w-36 h-36 rounded-full object-cover border-4 border-[var(--color-primary)] shadow-lg transition-all duration-200 bg-gray-100" style="display: {% if user.avatar %}block{% else %}none{% endif %};">
                            <ion-icon id="avatar-placeholder" name="person-circle-outline" class="w-36 h-36 text-gray-300 absolute top-0 left-0" style="display: {% if user.avatar %}none{% else %}block{% endif %};"></ion-icon>
                            <label for="id_avatar" class="absolute bottom-2 right-2 bg-[var(--color-primary)] text-white p-3 rounded-full shadow cursor-pointer hover:bg-[var(--color-primary-dark)] transition-all flex items-center justify-center border-2 border-white group-hover/avatar:scale-110" title="Alterar foto">
                                <ion-icon name="camera-outline" class="text-2xl"></ion-icon>
                            </label>
                        </div>
                        {% if user.avatar %}
                        <button type="button" id="remove-avatar" class="mt-2 text-xs text-red-500 underline hover:text-red-700 transition">Remover foto</button>
                        {% endif %}
                        <input type="file" id="id_avatar" name="avatar" accept="image/*" class="hidden">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="id_first_name" class="block text-gray-700 font-semibold mb-1">Nome</label>
                            {{ form.first_name }}
                        </div>
                        <div>
                            <label for="id_last_name" class="block text-gray-700 font-semibold mb-1">Sobrenome</label>
                            {{ form.last_name }}
                        </div>
                    </div>
                    <div>
                        <label for="id_email" class="block text-gray-700 font-semibold mb-1">Email</label>
                        {{ form.email }}
                    </div>
                    <div>
                        <label for="id_phone" class="block text-gray-700 font-semibold mb-1">Telefone</label>
                        {{ form.phone }}
                    </div>
                    <div>
                        <label for="id_bio" class="block text-gray-700 font-semibold mb-1">Sobre vocÃª</label>
                        {{ form.bio }}
                    </div>
                    <div class="flex justify-center w-full gap-4 mt-6">
                        <button type="submit" class="bg-[var(--color-primary)] text-white px-8 py-3 rounded-xl font-bold text-lg hover:bg-opacity-90 transition w-1/2">Salvar</button>
                        <a href="{% url 'admin_dashboard' %}" class="bg-gray-200 text-gray-700 px-8 py-3 text-center rounded-xl font-bold text-lg hover:bg-gray-300 transition w-1/2">Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<style>
    .profile-input, input[type="text"], input[type="email"], textarea {
        width: 100%;
        padding: 1rem;
        font-size: 1.18rem;
        border-radius: 0.9rem;
        border: 1.5px solid #d1d5db;
        background: #f9fafb;
        margin-top: 0.25rem;
        margin-bottom: 0.25rem;
        transition: border 0.2s, box-shadow 0.2s;
    }
    .profile-input:focus, input[type="text"]:focus, input[type="email"]:focus, textarea:focus {
        border-color: var(--color-primary);
        box-shadow: 0 0 0 2px rgba(59,130,246,0.2);
        outline: none;
        background: #fff;
    }
    .group/avatar:hover label[for="id_avatar"] {
        transform: scale(1.08);
        box-shadow: 0 4px 16px rgba(0,0,0,0.10);
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
    $(document).ready(function(){
        $('#id_phone').mask('(00) 00000-0000');
    });
    document.getElementById('id_avatar').addEventListener('change', function(e) {
        const [file] = this.files;
        if (file) {
            document.getElementById('avatar-preview').src = URL.createObjectURL(file);
            document.getElementById('avatar-preview').style.display = 'block';
            document.getElementById('avatar-placeholder').style.display = 'none';
        }
    });
    const removeBtn = document.getElementById('remove-avatar');
    if (removeBtn) {
        removeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('avatar-preview').src = '';
            document.getElementById('avatar-preview').style.display = 'none';
            document.getElementById('avatar-placeholder').style.display = 'block';
            document.getElementById('id_avatar').value = '';
        });
    }
</script>
{% endblock %}
